<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows 12 Ultra Simulation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- Core System --- */
        :root {
            --bg-glass: rgba(255, 255, 255, 0.85);
            --bg-window: rgba(255, 255, 255, 0.95);
            --text-color: #000;
            --border-color: rgba(0,0,0,0.1);
            --hover-bg: rgba(0,0,0,0.05);
        }
        
        .dark-mode {
            --bg-glass: rgba(30, 30, 30, 0.85);
            --bg-window: rgba(32, 32, 32, 0.95);
            --text-color: #fff;
            --border-color: rgba(255,255,255,0.1);
            --hover-bg: rgba(255,255,255,0.1);
        }

        body {
            overflow: hidden;
            font-family: 'Segoe UI Variable', 'Segoe UI', Tahoma, sans-serif;
            user-select: none;
            margin: 0; padding: 0;
            background: #000;
            cursor: default;
            color: var(--text-color);
        }

        /* --- Visuals --- */
        .glass {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
            transition: background 0.3s, color 0.3s;
        }

        /* Brightness Overlay */
        #brightness-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: black; opacity: 0; pointer-events: none; z-index: 9998;
            transition: opacity 0.1s;
        }

        /* Animations */
        @keyframes winPop { 0% { transform: scale(0.95) translateY(10px); opacity: 0; } 100% { transform: scale(1) translateY(0); opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(100%) translateX(-50%); } to { transform: translateY(0) translateX(-50%); } }

        /* Wallpaper */
        .desktop-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            transition: background-image 0.5s ease-in-out;
            z-index: 0;
        }

        /* --- Window System --- */
        .window {
            position: absolute;
            border-radius: 8px;
            display: flex; flex-direction: column;
            overflow: hidden;
            min-width: 300px; min-height: 200px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            animation: winPop 0.2s cubic-bezier(0.16, 1, 0.3, 1);
            resize: both;
            background: var(--bg-window);
            color: var(--text-color);
        }
        .window-header {
            height: 40px;
            display: flex; justify-content: space-between; align-items: center;
            cursor: default; 
            background: transparent;
            /* border-bottom: 1px solid var(--border-color); */
        }
        .win-controls { display: flex; height: 100%; }
        .win-btn {
            width: 46px; height: 100%; display: flex; align-items: center; justify-content: center;
            transition: background 0.2s; cursor: pointer; font-size: 14px;
        }
        .win-btn:hover { background: var(--hover-bg); }
        .win-btn.close:hover { background: #e81123; color: white; }
        
        .window-content { flex-grow: 1; position: relative; overflow: auto; }

        /* Desktop Icons */
        .desktop-icon {
            position: absolute;
            width: 86px; height: 96px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border-radius: 4px; transition: background 0.2s;
            color: white; text-shadow: 0 1px 3px rgba(0,0,0,0.8);
            cursor: pointer;
        }
        .desktop-icon:hover { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); }
        .desktop-icon.selected { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); }

        /* Taskbar */
        .taskbar-container {
            position: absolute; bottom: 12px; left: 0; width: 100%;
            display: flex; justify-content: center;
            z-index: 9000;
        }
        .taskbar {
            height: 52px;
            display: flex; align-items: center; gap: 6px;
            padding: 0 12px;
            border-radius: 12px;
            transition: all 0.3s;
        }
        .task-icon {
            width: 40px; height: 40px;
            border-radius: 6px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.2s;
            position: relative;
        }
        .task-icon:hover { background: rgba(255,255,255,0.15); }
        .task-icon.active::after {
            content: ''; position: absolute; bottom: -4px; width: 12px; height: 3px;
            background: #60cdff; border-radius: 2px;
        }
        .task-icon i { font-size: 22px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }

        /* Start Menu */
        .start-menu {
            position: absolute; bottom: 76px; left: 50%; transform: translateX(-50%);
            width: 640px; height: 600px;
            border-radius: 8px;
            display: none; flex-direction: column;
            z-index: 9001;
            padding: 24px;
            animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            color: var(--text-color);
        }
        .start-menu.active { display: flex; }

        /* Emulators */
        .android-frame { background: #1f2937; border-radius: 24px; padding: 8px; border: 4px solid #374151; height: 100%; display: flex; flex-direction: column; }
        .mac-frame { background: #000; height: 100%; display: flex; flex-direction: column; }

        /* Office Ribbon */
        .ribbon { display: flex; gap: 10px; padding: 8px; background: #f3f4f6; border-bottom: 1px solid #e5e7eb; align-items: center; }
        .dark-mode .ribbon { background: #2d2d2d; border-color: #404040; }
        .ribbon-btn { padding: 4px 8px; border-radius: 4px; cursor: pointer; display: flex; flex-direction: column; align-items: center; font-size: 11px; gap: 2px; }
        .ribbon-btn:hover { background: rgba(0,0,0,0.1); }
        .dark-mode .ribbon-btn:hover { background: rgba(255,255,255,0.1); }
        .ribbon-sep { width: 1px; height: 24px; background: #ccc; margin: 0 4px; }
    </style>
</head>
<body oncontextmenu="return false;">

    <div id="brightness-overlay"></div>

    <!-- Boot Screen -->
    <div id="boot-screen" style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:9999; background:black; color:white; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <i class="fab fa-windows text-6xl text-blue-500 mb-6"></i>
        <div class="loader w-8 h-8 border-2 border-t-transparent border-white rounded-full animate-spin"></div>
    </div>

    <!-- Desktop -->
    <div id="desktop-env" style="display: none; height: 100vh; position: relative; overflow: hidden;">
        <div id="wallpaper" class="desktop-bg" style="background-image: url('https://images.unsplash.com/photo-1579546929518-9e396f3cc809?ixlib=rb-1.2.1&auto=format&fit=crop&w=1920&q=80');"></div>

        <div id="desktop-icons-layer" class="absolute top-0 left-0 w-full h-full z-10"></div>
        <div id="windows-container" class="absolute top-0 left-0 w-full h-full z-20 pointer-events-none"></div>

        <!-- Start Menu -->
        <div id="start-menu" class="start-menu glass">
            <div class="bg-black/5 rounded-full px-4 py-2 flex items-center gap-2 mb-6 border border-white/10">
                <i class="fas fa-search opacity-50"></i>
                <input type="text" placeholder="חיפוש באפליקציות, הגדרות ומסמכים" class="bg-transparent border-none outline-none w-full text-sm placeholder-gray-500">
            </div>
            <div class="flex-grow overflow-auto">
                <div class="font-bold text-sm mb-4 px-2 opacity-80">ננעצו</div>
                <div class="grid grid-cols-6 gap-2" id="start-pinned"></div>
                <div class="font-bold text-sm mt-8 mb-4 px-2 opacity-80">מומלצים</div>
                <div class="grid grid-cols-2 gap-2" id="start-recommended"></div>
            </div>
            <div class="border-t border-gray-400/20 pt-4 flex justify-between items-center px-4 mt-2">
                <div class="flex items-center gap-3 cursor-pointer hover:bg-black/5 p-2 rounded-md transition">
                    <div class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center text-xs font-bold">A</div>
                    <span class="text-sm font-semibold">Admin</span>
                </div>
                <button onclick="systemAction('shutdown')" class="w-8 h-8 rounded hover:bg-black/10 flex items-center justify-center"><i class="fas fa-power-off"></i></button>
            </div>
        </div>

        <!-- Taskbar -->
        <div class="taskbar-container">
            <div class="taskbar glass">
                <div class="task-icon" onclick="toggleStartMenu()"><i class="fab fa-windows text-blue-500"></i></div>
                <div id="taskbar-apps" class="flex gap-1 mx-2"></div>
                <div class="task-icon ml-auto text-xs flex flex-col items-end px-2" onclick="openWindow('settings')">
                    <span id="clock-time" class="font-bold">12:00</span>
                    <span id="clock-date">01/01</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Virtual File System ---
        const vfs = {
            'Documents': {
                'Project_Alpha.docx': { app: 'word', content: '<h1>Project Alpha</h1><p>Confidential content.</p>' },
                'Budget_2025.xlsx': { app: 'excel', content: '' }
            }
        };

        // --- State ---
        let zIndex = 100;
        let activeWindows = {};
        const systemState = {
            darkMode: false,
            brightness: 100,
            wallpaper: 'https://images.unsplash.com/photo-1579546929518-9e396f3cc809?ixlib=rb-1.2.1&auto=format&fit=crop&w=1920&q=80'
        };

        // --- Apps ---
        const apps = [
            { id: 'explorer', name: 'סייר הקבצים', icon: 'fa-folder-open', color: 'text-yellow-500', w: 800, h: 500, init: initExplorer },
            { id: 'word', name: 'Word', icon: 'fa-file-word', color: 'text-blue-600', w: 900, h: 650, init: initWord },
            { id: 'excel', name: 'Excel', icon: 'fa-file-excel', color: 'text-green-600', w: 900, h: 650, init: initExcel },
            { id: 'ppt', name: 'PowerPoint', icon: 'fa-file-powerpoint', color: 'text-orange-600', w: 900, h: 650, init: initPPT },
            { id: 'settings', name: 'הגדרות', icon: 'fa-cog', color: 'text-gray-500', w: 800, h: 550, init: initSettings },
            { id: 'cmd', name: 'Terminal', icon: 'fa-terminal', color: 'text-gray-700', w: 600, h: 400, init: initCMD },
            { id: 'notes', name: 'פנקס רשימות', icon: 'fa-sticky-note', color: 'text-gray-600', w: 400, h: 300, init: initNotepad },
            { id: 'android', name: 'Android', icon: 'fa-robot', color: 'text-green-500', w: 380, h: 720, init: initAndroid },
            { id: 'mac', name: 'macOS VM', icon: 'fa-laptop', color: 'text-gray-800', w: 850, h: 550, init: initMac }
        ];

        // --- Boot ---
        window.onload = () => {
            setTimeout(() => {
                document.getElementById('boot-screen').style.display = 'none';
                document.getElementById('desktop-env').style.display = 'block';
                initDesktop();
            }, 2000);
        };

        function initDesktop() {
            renderDesktopIcons();
            renderTaskbar();
            renderStartMenu();
            setInterval(() => {
                const now = new Date();
                document.getElementById('clock-time').innerText = now.toLocaleTimeString('he-IL', {hour:'2-digit', minute:'2-digit'});
                document.getElementById('clock-date').innerText = now.toLocaleDateString('he-IL', {day:'2-digit', month:'2-digit'});
            }, 1000);
        }

        // --- UI Rendering ---
        function renderDesktopIcons() {
            const container = document.getElementById('desktop-icons-layer');
            const icons = [
                { app: 'explorer', label: 'מחשב זה', icon: 'fa-desktop', color: 'text-blue-400' },
                { app: 'word', label: 'Word', icon: 'fa-file-word', color: 'text-blue-600' },
                { app: 'excel', label: 'Excel', icon: 'fa-file-excel', color: 'text-green-600' },
                { app: 'ppt', label: 'PowerPoint', icon: 'fa-file-powerpoint', color: 'text-orange-600' },
                { app: 'settings', label: 'הגדרות', icon: 'fa-cog', color: 'text-gray-300' },
                { app: 'android', label: 'Android', icon: 'fa-robot', color: 'text-green-500' },
                { app: 'mac', label: 'macOS VM', icon: 'fa-laptop', color: 'text-gray-200' }
            ];
            
            let row=0, col=0;
            icons.forEach(i => {
                const div = document.createElement('div');
                div.className = 'desktop-icon';
                div.style.top = (20 + row * 106) + 'px';
                div.style.right = (20 + col * 96) + 'px'; // RTL
                div.innerHTML = `<i class="fas ${i.icon} text-3xl mb-2 ${i.color}"></i><span class="text-xs text-center leading-tight shadow-black">${i.label}</span>`;
                div.ondblclick = () => openWindow(i.app);
                container.appendChild(div);
                row++; if(row > 5) { row=0; col++; }
            });
        }

        function renderTaskbar() {
            const container = document.getElementById('taskbar-apps');
            apps.forEach(app => {
                const div = document.createElement('div');
                div.className = 'task-icon';
                div.id = 'task-' + app.id;
                div.onclick = () => openWindow(app.id);
                div.innerHTML = `<i class="fas ${app.icon} ${app.color}"></i>`;
                container.appendChild(div);
            });
        }

        function renderStartMenu() {
            const pinned = document.getElementById('start-pinned');
            apps.forEach(app => {
                const el = document.createElement('div');
                el.className = 'flex flex-col items-center gap-2 cursor-pointer p-2 hover:bg-white/10 rounded-lg transition';
                el.onclick = () => { openWindow(app.id); toggleStartMenu(); };
                el.innerHTML = `<i class="fas ${app.icon} text-xl ${app.color}"></i><span class="text-xs opacity-90">${app.name}</span>`;
                pinned.appendChild(el);
            });
        }

        function toggleStartMenu() {
            const menu = document.getElementById('start-menu');
            if(menu.classList.contains('active')) menu.classList.remove('active');
            else { menu.classList.add('active'); menu.style.zIndex = ++zIndex + 100; }
        }

        // --- Window Manager ---
        function openWindow(appId) {
            const app = apps.find(a => a.id === appId);
            const id = appId + '_' + Date.now();
            zIndex++;
            
            // Pointer events for dragging
            document.getElementById('windows-container').style.pointerEvents = 'auto';

            const win = document.createElement('div');
            win.className = 'window glass';
            win.id = id;
            win.style.width = app.w + 'px'; win.style.height = app.h + 'px';
            win.style.zIndex = zIndex;
            win.style.top = (50 + Math.random()*50) + 'px'; win.style.left = (50 + Math.random()*50) + 'px';

            // Windows Style Header
            const header = document.createElement('div');
            header.className = 'window-header';
            header.innerHTML = `
                <div class="flex items-center gap-3 px-3 text-sm font-semibold opacity-80">
                    <i class="fas ${app.icon}"></i>
                    <span>${app.name}</span>
                </div>
                <div class="win-controls">
                    <div class="win-btn" onclick="minimizeWindow('${id}')"><i class="fas fa-minus"></i></div>
                    <div class="win-btn" onclick="maximizeWindow('${id}')"><i class="far fa-square"></i></div>
                    <div class="win-btn close" onclick="closeWindow('${id}')"><i class="fas fa-times"></i></div>
                </div>
            `;
            // Drag
            header.onmousedown = (e) => {
                if(e.target.closest('.win-btn')) return;
                zIndex++; win.style.zIndex = zIndex;
                let shiftX = e.clientX - win.getBoundingClientRect().left;
                let shiftY = e.clientY - win.getBoundingClientRect().top;
                function moveAt(pageX, pageY) {
                    win.style.left = pageX - shiftX + 'px';
                    win.style.top = pageY - shiftY + 'px';
                }
                function onMouseMove(event) { moveAt(event.pageX, event.pageY); }
                document.addEventListener('mousemove', onMouseMove);
                header.onmouseup = () => { document.removeEventListener('mousemove', onMouseMove); header.onmouseup = null; };
            };

            const content = document.createElement('div');
            content.className = 'window-content';
            
            win.appendChild(header);
            win.appendChild(content);
            document.getElementById('windows-container').appendChild(win);
            document.getElementById('task-'+appId).classList.add('active');
            
            if(app.init) app.init(content, id);
        }

        function closeWindow(id) {
            const win = document.getElementById(id);
            win.style.opacity = 0; win.style.transform = 'scale(0.9)';
            setTimeout(() => {
                win.remove();
                const appId = id.split('_')[0];
                if(!document.querySelector(`[id^="${appId}_"]`)) document.getElementById('task-'+appId).classList.remove('active');
            }, 200);
        }
        function minimizeWindow(id) { document.getElementById(id).style.display = 'none'; }
        function maximizeWindow(id) {
            const win = document.getElementById(id);
            if(win.style.width === '100%') {
                win.style.width = '800px'; win.style.height = '600px'; win.style.top = '50px'; win.style.left = '50px';
            } else {
                win.style.width = '100%'; win.style.height = '100%'; win.style.top = '0'; win.style.left = '0';
            }
        }

        // --- Apps Logic ---

        // 1. SETTINGS (Improved)
        function initSettings(c) {
            c.innerHTML = `
                <div class="flex h-full text-sm">
                    <div class="w-1/4 border-l border-gray-300/20 p-2 flex flex-col gap-1 bg-gray-50/50 dark:bg-gray-800/50">
                        <div class="p-3 flex items-center gap-3 mb-2">
                             <div class="w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold">A</div>
                             <div><div class="font-bold">Admin</div><div class="text-xs opacity-60">Local Account</div></div>
                        </div>
                        <input type="text" placeholder="חיפוש בהגדרות" class="mb-4 p-2 rounded border bg-white/50 w-full">
                        ${['מערכת', 'Bluetooth והתקנים', 'רשת ואינטרנט', 'התאמה אישית', 'אפליקציות', 'חשבונות', 'זמן ושפה', 'משחקים', 'נגישות', 'Windows Update'].map((item, i) => 
                            `<div class="p-2 rounded hover:bg-black/5 cursor-pointer flex items-center gap-3 ${i===0?'bg-white shadow-sm':''}">
                                <i class="fas fa-${['laptop','bluetooth','wifi','paint-brush','th','user','clock','gamepad','universal-access','sync'][i]} w-5 text-center text-blue-500"></i> ${item}
                            </div>`
                        ).join('')}
                    </div>
                    <div class="w-3/4 p-6 overflow-auto bg-white/80 dark:bg-[#202020]/90">
                        <h2 class="text-2xl font-bold mb-6">מערכת</h2>
                        
                        <!-- Display Section -->
                        <div class="mb-6 p-4 bg-white/50 dark:bg-white/5 rounded-lg border border-gray-200/50">
                            <div class="flex items-center gap-3 mb-4"><i class="fas fa-sun text-xl"></i> <span class="font-bold">תצוגה</span></div>
                            <div class="flex items-center justify-between mb-2">
                                <span>בהירות</span>
                                <input type="range" min="20" max="100" value="${systemState.brightness}" oninput="setBrightness(this.value)" class="w-48">
                            </div>
                            <div class="flex items-center justify-between">
                                <span>מצב לילה</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                  <input type="checkbox" class="sr-only peer">
                                  <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                        </div>

                         <!-- Personalization Section Preview -->
                        <h2 class="text-2xl font-bold mb-6 mt-8">התאמה אישית</h2>
                        <div class="grid grid-cols-2 gap-4 mb-6">
                             <div class="p-4 bg-white/50 dark:bg-white/5 rounded-lg border border-gray-200/50 cursor-pointer" onclick="toggleDarkMode()">
                                <div class="font-bold mb-2">בחר מצב</div>
                                <div class="flex items-center gap-2"><i class="fas fa-adjust"></i> <span>${systemState.darkMode ? 'כהה (פעיל)' : 'בהיר (פעיל)'} - לחץ להחלפה</span></div>
                             </div>
                        </div>

                        <div class="font-bold mb-2">רקע לשולחן העבודה</div>
                        <div class="grid grid-cols-3 gap-3">
                             ${[
                                 'https://images.unsplash.com/photo-1579546929518-9e396f3cc809',
                                 'https://images.unsplash.com/photo-1477346611705-65d1883cee1e',
                                 'https://images.unsplash.com/photo-1506744038136-46273834b3fb',
                                 'https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe'
                             ].map(url => 
                                 `<div class="aspect-video rounded overflow-hidden cursor-pointer border-2 border-transparent hover:border-blue-500" onclick="setWall('${url}')">
                                    <img src="${url}?auto=format&fit=crop&w=400&q=80" class="w-full h-full object-cover">
                                 </div>`
                             ).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        // 2. WORD (Ribbon & Features)
        function initWord(c, id) {
            c.innerHTML = `
                <div class="flex flex-col h-full bg-gray-100 dark:bg-[#333]">
                    <!-- Title Bar (in Ribbon style) -->
                    <div class="bg-[#2b579a] text-white px-2 py-1 text-xs flex gap-4">
                        <span class="opacity-80">שמירה אוטומטית</span> <span><i class="fas fa-save"></i></span>
                    </div>
                    <!-- Ribbon -->
                    <div class="ribbon bg-white dark:bg-[#444] text-xs">
                        <div class="ribbon-btn text-blue-600 font-bold">קובץ</div>
                        <div class="ribbon-sep"></div>
                        <div class="ribbon-btn" onclick="execCmd('bold')"><i class="fas fa-bold"></i> מודגש</div>
                        <div class="ribbon-btn" onclick="execCmd('italic')"><i class="fas fa-italic"></i> נטוי</div>
                        <div class="ribbon-btn" onclick="execCmd('underline')"><i class="fas fa-underline"></i> קו תחתון</div>
                        <div class="ribbon-sep"></div>
                        <div class="ribbon-btn" onclick="execCmd('justifyLeft')"><i class="fas fa-align-left"></i></div>
                        <div class="ribbon-btn" onclick="execCmd('justifyCenter')"><i class="fas fa-align-center"></i></div>
                        <div class="ribbon-btn" onclick="execCmd('justifyRight')"><i class="fas fa-align-right"></i></div>
                        <div class="ribbon-sep"></div>
                        <div class="ribbon-btn" onclick="execCmd('insertUnorderedList')"><i class="fas fa-list-ul"></i> תבליטים</div>
                        <div class="ribbon-btn" onclick="execCmd('foreColor', 'red')"><i class="fas fa-font text-red-500"></i> אדום</div>
                        <div class="ribbon-btn" onclick="execCmd('foreColor', 'blue')"><i class="fas fa-font text-blue-500"></i> כחול</div>
                        <div class="ml-auto ribbon-btn"><i class="fas fa-microphone"></i> הכתבה</div>
                    </div>
                    <!-- Page -->
                    <div class="flex-grow bg-gray-200 dark:bg-[#222] overflow-auto p-8 flex justify-center">
                        <div class="bg-white w-[21cm] min-h-[29.7cm] shadow-xl p-[2.5cm] outline-none text-right text-black" contenteditable="true">
                            <h1 style="font-size: 24px; font-weight: bold; border-bottom: 2px solid #2b579a; margin-bottom: 10px; color: #2b579a;">מסמך חדש</h1>
                            <p>התחל להקליד כאן. כל כפתורי העיצוב למעלה עובדים!</p>
                            <ul><li>נסה להדגיש טקסט</li><li>לשנות צבעים</li></ul>
                        </div>
                    </div>
                    <!-- Status Bar -->
                    <div class="bg-[#2b579a] text-white text-[10px] px-2 py-1 flex justify-between">
                         <span>עמוד 1 מתוך 1</span> <span>עברית</span>
                    </div>
                </div>
            `;
        }

        // 3. EXCEL (Improved Grid & Formulas)
        function initExcel(c, id) {
            c.innerHTML = `
                <div class="flex flex-col h-full bg-white dark:bg-[#333] text-sm">
                    <div class="bg-[#217346] text-white px-2 py-1 text-xs">Excel</div>
                    <div class="ribbon bg-white dark:bg-[#444]">
                        <div class="ribbon-btn"><i class="fas fa-paste"></i> הדבק</div>
                        <div class="ribbon-btn"><i class="fas fa-copy"></i> העתק</div>
                        <div class="ribbon-sep"></div>
                        <div class="ribbon-btn font-bold">B</div>
                        <div class="ribbon-btn italic">I</div>
                        <div class="ribbon-sep"></div>
                        <div class="ribbon-btn" onclick="alert('פונקציית סכום הופעלה על התאים')"><i class="fas fa-calculator"></i> סכום אוטומטי</div>
                    </div>
                    <div class="flex items-center border-b p-1 bg-gray-100 dark:bg-[#333] dark:border-gray-600">
                        <div class="w-10 text-center border bg-white dark:bg-[#444] dark:border-gray-500 mr-2 text-xs py-1">A1</div>
                        <input type="text" class="flex-grow border px-2 py-1 text-xs dark:bg-[#444] dark:border-gray-500 dark:text-white" placeholder="fx">
                    </div>
                    <div class="flex-grow overflow-auto relative">
                        <div class="grid grid-cols-[40px_repeat(10,100px)]">
                            <div class="bg-gray-100 border-b border-r dark:bg-[#444] dark:border-gray-600"></div>
                            ${Array.from({length:10},(_,i)=>`<div class="bg-gray-100 border-b border-r text-center text-xs p-1 font-bold dark:bg-[#444] dark:border-gray-600">${String.fromCharCode(65+i)}</div>`).join('')}
                            ${Array.from({length:30},(_,r)=>
                                `<div class="bg-gray-100 border-b border-r text-center text-xs p-1 dark:bg-[#444] dark:border-gray-600">${r+1}</div>` +
                                Array.from({length:10},()=>`<input class="border-b border-r text-xs p-1 outline-none focus:border-green-500 focus:border-2 dark:bg-[#222] dark:border-gray-600 dark:text-white">`).join('')
                            ).join('')}
                        </div>
                    </div>
                     <div class="bg-gray-100 dark:bg-[#333] border-t px-2 py-1 text-xs flex gap-2">
                        <span class="bg-white dark:bg-[#555] px-3 py-1 rounded-t shadow text-green-700 dark:text-green-400 font-bold">גיליון1</span>
                        <span class="px-2 py-1 opacity-50">+</span>
                    </div>
                </div>
            `;
        }

        // 4. POWERPOINT (Re-implemented)
        let pptSlides = [{title: "כותרת ראשית", sub: "כותרת משנה"}, {title: "תוכן העניינים", sub: "נקודה 1\nנקודה 2"}];
        function initPPT(c, id) {
            c.innerHTML = `
                <div class="flex flex-col h-full bg-white dark:bg-[#333]">
                    <div class="bg-[#b7472a] text-white px-2 py-1 text-xs">PowerPoint</div>
                    <div class="ribbon bg-white dark:bg-[#444]">
                        <div class="ribbon-btn" onclick="addSlide('${id}')"><i class="fas fa-plus-square text-orange-600"></i> שקופית חדשה</div>
                        <div class="ribbon-sep"></div>
                        <div class="ribbon-btn"><i class="fas fa-image"></i> תמונה</div>
                        <div class="ribbon-btn"><i class="fas fa-shapes"></i> צורות</div>
                        <div class="ml-auto ribbon-btn" onclick="alert('מצגת מתחילה...')"><i class="fas fa-play text-green-600"></i> הצג</div>
                    </div>
                    <div class="flex flex-grow overflow-hidden">
                        <!-- Sidebar -->
                        <div class="w-40 bg-gray-100 dark:bg-[#2a2a2a] border-l dark:border-gray-600 p-2 overflow-y-auto flex flex-col gap-2" id="ppt-sidebar-${id}">
                            <!-- Slides -->
                        </div>
                        <!-- Stage -->
                        <div class="flex-grow bg-gray-200 dark:bg-[#202020] p-8 flex items-center justify-center">
                            <div class="bg-white aspect-video w-full shadow-2xl p-8 flex flex-col justify-center items-center text-center select-text" id="ppt-stage-${id}" contenteditable="true">
                                <!-- Active Slide -->
                            </div>
                        </div>
                    </div>
                </div>
            `;
            renderPPT(id, 0);
        }
        window.addSlide = (id) => { pptSlides.push({title: "שקופית חדשה", sub: "הוסף טקסט"}); renderPPT(id, pptSlides.length-1); };
        window.renderPPT = (id, idx) => {
            const sb = document.getElementById(`ppt-sidebar-${id}`);
            const st = document.getElementById(`ppt-stage-${id}`);
            if(!sb || !st) return;
            
            sb.innerHTML = pptSlides.map((s, i) => `
                <div class="aspect-video bg-white border ${i===idx?'border-orange-500 ring-2 ring-orange-200':''} shadow-sm p-1 text-[5px] cursor-pointer overflow-hidden" onclick="renderPPT('${id}', ${i})">
                    <div class="font-bold">${s.title}</div><div>${s.sub}</div>
                </div>
            `).join('');

            st.innerHTML = `
                <h1 class="text-4xl font-bold mb-4 text-gray-800 border border-dashed border-transparent hover:border-gray-400 p-2 w-full">${pptSlides[idx].title}</h1>
                <div class="text-xl text-gray-500 w-full border border-dashed border-transparent hover:border-gray-400 p-2 whitespace-pre-wrap">${pptSlides[idx].sub}</div>
            `;
        }

        // 5. CMD
        function initCMD(c, id) {
            c.innerHTML = `
                <div class="bg-black text-gray-300 font-mono text-sm h-full p-2 overflow-auto" onclick="document.getElementById('cmd-in-${id}').focus()">
                    <div>Microsoft Windows [Version 12.0.22621.1]<br>(c) Microsoft Corporation. All rights reserved.</div><br>
                    <div id="cmd-out-${id}"></div>
                    <div class="flex">
                        <span class="mr-2 text-white">C:\\Users\\Admin></span>
                        <input id="cmd-in-${id}" class="bg-transparent border-none outline-none text-white flex-grow font-mono" autocomplete="off" onkeydown="handleCMD(event, '${id}')">
                    </div>
                </div>
            `;
        }
        window.handleCMD = (e, id) => {
            if(e.key === 'Enter') {
                const val = e.target.value;
                const out = document.getElementById(`cmd-out-${id}`);
                out.innerHTML += `<div><span class="text-white">C:\\Users\\Admin></span> ${val}</div>`;
                if(val === 'dir') out.innerHTML += `<div>01/01/2025 <DIR> Documents<br>01/01/2025 <DIR> Downloads</div>`;
                else if(val === 'cls') out.innerHTML = '';
                else if(val === 'help') out.innerHTML += `<div>Commands: dir, cls, echo, exit, help</div>`;
                else out.innerHTML += `<div class="text-red-400">'${val}' is not recognized.</div>`;
                e.target.value = '';
                e.target.parentElement.parentElement.scrollTop = 99999;
            }
        }

        // 6. ANDROID
        function initAndroid(c, id) {
            c.innerHTML = `<div class="android-frame bg-gray-900"><div class="android-screen flex flex-col items-center justify-center text-white"><i class="fab fa-android text-6xl text-green-500 mb-4"></i><div>Android OS</div><div class="mt-4 grid grid-cols-4 gap-4"><div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center"><i class="fas fa-phone"></i></div><div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center"><i class="fas fa-comment"></i></div><div class="w-10 h-10 bg-gray-500 rounded-full flex items-center justify-center"><i class="fas fa-camera"></i></div><div class="w-10 h-10 bg-orange-500 rounded-full flex items-center justify-center"><i class="fab fa-chrome"></i></div></div></div></div>`;
        }

        // 7. MAC
        function initMac(c, id) {
            c.innerHTML = `<div class="mac-frame"><div class="bg-white/20 h-6 w-full flex items-center px-4 text-xs text-white gap-4 font-bold"><span></span><span>Finder</span><span>File</span><span>Edit</span></div><div class="flex-grow relative bg-[url('https://images.unsplash.com/photo-1496664444929-8c75efb9546f?w=800')] bg-cover"><div class="absolute bottom-2 left-1/2 -translate-x-1/2 bg-white/30 backdrop-blur rounded-2xl p-2 flex gap-4"><div class="w-10 h-10 bg-blue-500 rounded-xl"></div><div class="w-10 h-10 bg-gray-200 rounded-xl"></div></div></div></div>`;
        }

        // --- Helpers ---
        window.setBrightness = (val) => {
            systemState.brightness = val;
            document.getElementById('brightness-overlay').style.opacity = (100 - val) / 100;
        }
        window.toggleDarkMode = () => {
            systemState.darkMode = !systemState.darkMode;
            document.body.classList.toggle('dark-mode');
            // Refresh settings window if open
            // (In a real app, this would use React/Vue state binding)
        }
        window.setWall = (url) => {
            document.getElementById('wallpaper').style.backgroundImage = `url('${url}')`;
        }
        window.execCmd = (cmd, arg=null) => {
            document.execCommand(cmd, false, arg);
        }
        
        // Placeholder inits
        function initExplorer(c){ c.innerHTML = '<div class="p-4">סייר הקבצים - תצוגה מהירה</div>'; }
        function initNotepad(c){ c.innerHTML = '<textarea class="w-full h-full p-2 border-none outline-none resize-none bg-transparent" placeholder="הקלד..."></textarea>'; }

        function systemAction(act) { location.reload(); }

    </script>
</body>
</html>
